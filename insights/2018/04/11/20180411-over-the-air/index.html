<!doctype html><html lang=en-us><head><link rel=preconnect href=https://fonts.googleapis.com><link rel=dns-prefetch href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com><link rel=dns-prefetch href=https://fonts.gstatic.com><link rel=preconnect href=https://cdnjs.cloudflare.com><link rel=dns-prefetch href=https://cdnjs.cloudflare.com><link rel=preconnect href=https://www.googletagmanager.com><link rel=dns-prefetch href=https://www.googletagmanager.com><link rel=dns-prefetch href=https://cdn.jsdelivr.net><link rel=preconnect href=https://cdn.jsdelivr.net><meta charset=utf-8><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Linux microPlatform, now with OTA updates (beta) | Foundries.io</title><link rel="shortcut icon" href=/images/icons/favicon.ico><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:300,400,500,700,900"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css integrity="sha256-HtCCUh9Hkh//8U1OwcbD8epVEUdBvuI8wj1KtqMhNkI=" crossorigin=anonymous><link rel=stylesheet href=/css/foundation.min.228f9b8bdf4aae06e794eb13011f0858c2d27f9d39a55e09bbe84ff4bc8644c4.css><link rel=stylesheet href=/style.insights.bundle.min.af3e9cf79a7b55f0a085b87f7afe4f1a5cc063cd95e3b2798adc0649211ca1bd.css><link rel=stylesheet href=/css/slicknav.min.css><link rel=stylesheet type=text/css href=https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css></head><body><div class="top sticky"><div class=row><div class="small-12 large-3 medium-3 columns"><div class=logo><a href=/><img src=/images/logo.png alt="Foundries.io logo"></a></div></div><div class="small-12 large-9 medium-9 columns"><nav class=desktop-menu><ul class=sf-menu id=navigation><li><a href=/company/>ABOUT</a><ul class=nav-menu><li><a href=/company/>COMPANY</a></li><li><a href=/careers/>CAREERS</a></li></ul></li><li><a href=/insights/>INSIGHTS</a><ul class=nav-menu><li><a href=/insights/>BLOG</a></li><li><a href=/categories/news-and-media/>NEWS</a></li><li><a href=/categories/updates/>UPDATES</a></li></ul></li><li><a href=/partners/>PARTNERS</a><ul class=nav-menu><li><a href=/partners/>PARTNER PROGRAM</a></li><li><a href=/partners/all/>OUR PARTNERS</a></li></ul></li><li><a href=/products/>PRODUCTS</a><ul class=nav-menu><li><a href=/products/>FACTORY</a></li><li><a href=/pricing/>PRICING</a></li><li><a href=/hardware/>HARDWARE</a></li><li><a href=/terms/>TERMS &amp; CONDITIONS</a></li></ul></li><li><a href="https://app.foundries.io/login/?next=/"><i class="fa fa-cloud-upload"></i>&nbsp;ENGAGE</a><ul class=nav-menu><li><a href=https://app.foundries.io/docs/>DOCUMENTATION</a></li><li><a href="https://app.foundries.io/login/?next=/">DASHBOARD</a></li><li><a href=https://support.foundries.io>SUPPORT</a></li><li><a href=https://join.slack.com/t/foundriesio/shared_invite/enQtNTc5NDkxNTI5NTExLWQ1Yjc3NDA2MjI3NzA3YzkxYjEzNzlhZjQ0M2QxYTIzYmIzZjlmOThmZGU0NTk5MWEwZGIwMTU2YWE4N2I5NWQ>SLACK</a></li><li><a href=https://docs.foundries.io/latest/customer-factory/index.html>START YOUR FACTORY</a></li></ul></li></ul></nav></div></div></div><header class=alt-6><div class=message><div class=row><div class="small-12 columns"><div class=message-intro><span class=message-line></span><p>FOUNDRIES.IO INSIGHTS</p><span class=message-line></span></div><h1>Linux microPlatform, now with OTA updates (beta)</h1><p class="text-muted text-uppercase mb-small text-right color-white">April 11, 2018</p></div></div></div></header><div id=content><div class=container><div class=row><div class="small-12 columns" id=insights-post><div id=post-content><p>Starting with Linux microPlatform update 0.13, we are including support for over-the-air (OTA) updates.</p><p>After extensive research, discussion in the embedded Linux community and a review of
the current Linux OTA solutions, we concluded that update systems should be protected
by comprehensive update frameworks that are designed to protect against known exploits
at a minimum.</p><p>Through advanced key management practices, <a href=https://theupdateframework.github.io/>TUF</a>
(the update framework) and <a href=https://uptane.github.io/>UPTANE</a> (TUF principles adapted
to safety critical / automotive embedded systems) provide solid foundations against
many of today&rsquo;s most malicious attacks.</p><ul><li>Arbitrary installation attacks.</li><li>Endless data attacks.</li><li>Extraneous dependencies attacks.</li><li>Fast-forward attacks.</li><li>Indefinite freeze attacks.</li><li>Malicious mirrors preventing updates.</li><li>Mix-and-match attacks.</li><li>Rollback attacks.</li><li>Slow retrieval attacks.</li><li>Vulnerability to key compromises.</li><li>Wrong software installation.</li></ul><p>During our investigations we started working with the team at Advanced Telematics
(acquired by <a href=https://www.here.com/en>HERE technologies</a> in 2018) and started learning
about their update platform that was used in Automotive Grade Linux,
<a href=https://app.atsgarage.com/login>&ldquo;ATS Garage&rdquo;</a>. In January 2018, the team released their
platform as an open source project, <a href=https://github.com/advancedtelematic/ota-community-edition>OTA Community Edition</a>
and we went to work integrating with the system as it provides, what we believe is
the highest level of security for embedded system software updates.</p><p>We won&rsquo;t go into all of the details right now, but you can find out more from the following links:</p><ul><li>Documentation available at: <a href=https://docs.atsgarage.com/usage/devices.html>https://docs.atsgarage.com/usage/devices.html</a></li><li>Source code available at: <a href=https://github.com/advancedtelematic/ota-community-edition>https://github.com/advancedtelematic/ota-community-edition</a></li></ul><h2 id=overview>Overview</h2><ul><li>As this support is part of a subscriber update, you&rsquo;ll need to setup a
subscription account on <a href=https://app.foundries.io>https://app.foundries.io</a></li><li>Get a supported hardware development platform (Raspberry Pi 3, DragonBoard-410c,
DragonBoard-820c, Toradex Colibri iMX7D, Solidrun HummingBoard 2, Compulab IoT Gate,
Beaglebone Black Wireless, x86)</li><li>Download the latest system image: <a href=https://app.foundries.io/mp/lmp/latest/artifacts/>https://app.foundries.io/mp/lmp/latest/artifacts/</a>
(0.13 and later will be OTA ready)</li><li>Install the Linux microPlatform</li><li>Upload an OS to ATS Garage for deployment</li><li>Provision your device</li><li>Upload a second OS to ATS Garage</li><li>Deploy the new OS to your device(s)</li><li>Reboot to activate the new image</li></ul><h2 id=ats-garage>ATS Garage</h2><p>To get started updating your Linux microPlatform devices follow these instructions:</p><p><strong>Install the Linux microPlatform</strong></p><pre><code>NOTE: You must use update 0.13 or newer builds with the OSTree repo
</code></pre><p>Follow the documentation to <a href=https://app.foundries.io/docs/latest/tutorial/installation-linux.html>install the Linux microPlatform</a>.
With a running Linux microPlatform system, follow the next steps to provision your device on ATS Garage.</p><p><strong>Create an ATS Garage Account</strong></p><p>Create an ATS Garage account at <a href=https://app.atsgarage.com/>https://app.atsgarage.com/</a> .</p><p><strong>Create your ATS Garage credentials</strong></p><p>Generate your auto provisioning credentials at <a href=https://app.atsgarage.com/#/profile/access-keys>https://app.atsgarage.com/#/profile/access-keys</a></p><p>Once you generate your credentials you can use the same credentials on many
devices. These credentials are used to generate device-specific keys during
initial device provisioning and to sign the OSTree repository when you upload
the repo to ATS garage.</p><p><strong>Push the Linux microPlatform image to ATS garage</strong></p><p>You can use a command line tool to sign and publish the artifacts of a build to
ATS Garage (e.g. for Raspberry Pi 3)</p><ul><li><p>Create a clean directory with your credentials.zip file and the OSTree Repo</p><pre><code>$ mkdir lmp
$ cd lmp
</code></pre></li><li><p>Download your ATS Garage credentials file (<a href=https://app.atsgarage.com/#/profile/access-keys>https://app.atsgarage.com/#/profile/access-keys</a>) and make it available in a local folder</p></li><li><p>Download and extract microPlatform OSTree repository tarball from a specific LMP build number (e.g. <a href=https://app.foundries.io/mp/lmp/0.13/artifacts/supported-raspberrypi3-64/other/raspberrypi3-64-ostree_repo.tar.bz2>https://app.foundries.io/mp/lmp/0.13/artifacts/supported-raspberrypi3-64/other/raspberrypi3-64-ostree_repo.tar.bz2</a>)</p><pre><code>$ tar -jxvf raspberrypi3-64-ostree_repo.tar.bz2
</code></pre></li><li><p>Identify the image version ID from the running LMP system if provisioning your device for the first time</p><ul><li>This is required to avoid a version mismatch between the running system and the uploaded image</li><li>In a future update this step will not be required</li></ul><pre><code>raspberrypi3-64:~$ sed -e &quot;s/.*lmp-//&quot; -e &quot;s/\&quot;}//&quot; /var/sota/installed_versions
283
</code></pre></li><li><p>Set the version ID for the uploaded image</p><ul><li>Same as described in the previous step if provisioning for the first time</li><li>When uploading additional image updates just use the microPlatform update version instead (e.g. 0.14)</li></ul><pre><code>$ VERSION=283
</code></pre></li><li><p>Run our image publishing script using a docker container in order to sign and push the image to ATS Garage</p><pre><code>$ docker run --rm -it -v $PWD:/build --workdir=/build opensourcefoundries/aktualizr \
  ota-publish -m raspberrypi3-64 -c credentials.zip -r ostree_repo -v $VERSION
</code></pre></li></ul><p>In case of upload errors (e.g. OSTree fetch error: 502), please make sure to retry a few more times as the server might be overloaded.</p><p><strong>Verify the Package can be viewed on the ATS Garage</strong></p><p>Browse to: <a href=https://app.atsgarage.com/#/packages/raspberrypi3-64-lmp>https://app.atsgarage.com/#/packages/raspberrypi3-64-lmp</a></p><h2 id=device-configuration>Device configuration</h2><p>Now that we have an update loaded into ATS garage, we will provision the device, we
are using the Raspberry Pi 3 for demonstration purposes, though the other boards can
also be used.</p><p><strong>Copy and start the Aktualizr client daemon</strong></p><p>on your host machine:</p><pre><code>$ scp credentials.zip osf@raspberrypi3-64.local:~/
</code></pre><p>on your target machine: (ssh to the system)</p><pre><code>$ sudo mv credentials.zip /var/sota/sota_provisioning_credentials.zip
$ sudo cp /usr/lib/sota/sota_autoprov.toml /var/sota/sota.toml

# Note: Aktualizr will start automatically once it finds /var/sota/sota.toml
</code></pre><p><strong>Browse to your ATS Garage account and manage the device&rsquo;s root filysystem</strong></p><p>If everything goes right, your device will auto-register to the ATS Garage system.
This may take a few minutes.</p><p>You can begin managing the system the moment you upload the next update. At
Foundries.io we produce OS updates about every 10 days, so one will be
available soon.</p><p>Once you upload a second image to ATS Garage, you can initiate an OS upgrade from
the ATS web system and then reboot the target device to activate the image.</p><p>Further documentation will be available soon.</p><h1 id=issues-and-observations>Issues and observations</h1><h2 id=watching-the-aktualizr-logs>Watching the aktualizr logs</h2><p>If you are having a problem with the device connecting to ATS garage, you can
watch the client logs with the following commands</p><pre><code>sudo journalctl -f -u aktualizr.service
</code></pre><h2 id=device-fails-to-show-up-on-ats-garage>Device fails to show up on ATS garage</h2><p>We have recently noticed a variety of timeouts when communicating with ATS
garage. From our experience, most of these timeouts and communication failures
will self-recover. If you notice a delay in device communication or
registration you can review the aktualizr client logs (see above).</p><p>A sample set of errors that seem to be recoverable may look like:</p><pre><code>Apr 26 17:15:18 raspberrypi3-64 aktualizr[592]: curl error 28 (http code 0): Timeout was reached
Apr 26 17:15:19 raspberrypi3-64 aktualizr[592]: curl error 35 (http code 0): SSL connect error

</code></pre><h2 id=device-fails-to-sync-and-krejectall-observed>Device fails to sync and kRejectAll observed</h2><p>We have noticed that from time to time, the aktualizr client delivered in
update 0.13 is susceptible to an issue that has been fixed in 0.14 and later
microPlatform updates.</p><p>The issue, which has been fixed in the upstream aktualizr client, puts the
device into a state where it can not take an update.</p><p>To work around this issue you can use the following commands to modify the
SQLite database.</p><pre><code># stop the aktualizr service
sudo systemctl stop aktualizr.service

# remove the 'meta' table from the sqlite database
docker run -v /var/sota/sql.db:/sql.db opensourcefoundries/utilities sqlite3 /sql.db &quot;drop table meta;&quot;

# start the aktualizer service
sudo systemctl start aktualizr.service

# OPTIONAL: you can watch the aktualizr logs to verify the connection
sudo journalctl -f -u aktualizr.service
</code></pre></div><div id=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"foundriesio"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div><div class=row><div class="small-12 columns"><div class=post-categories><div class="panel panel-default sidebar-menu"><div class=panel-heading><h3 class=panel-title>Categories</h3></div><div class=panel-body><ul class="nav nav-pills nav-stacked"><li><a href=https://foundries.io/categories/blockchain>blockchain (1)</a></li><li><a href=https://foundries.io/categories/conferences>conferences (4)</a></li><li><a href=https://foundries.io/categories/demos>demos (1)</a></li><li><a href=https://foundries.io/categories/fota>fota (10)</a></li><li><a href=https://foundries.io/categories/microplatform>microplatform (7)</a></li><li><a href=https://foundries.io/categories/news-and-media>news-and-media (9)</a></li><li><a href=https://foundries.io/categories/updates>updates (55)</a></li><li><a href=https://foundries.io/categories/zephyr-mp>zephyr-mp (2)</a></li><li><a href=https://foundries.io/categories/zephyr-news>zephyr-news (16)</a></li></ul></div></div><div class="panel sidebar-menu"><div class=panel-heading><h3 class=panel-title>Tags</h3></div><div class=panel-body><ul class=tag-cloud><li><a href=https://foundries.io/tags/ai><i class="fa fa-tags"></i>ai</a></li><li><a href=https://foundries.io/tags/assistant><i class="fa fa-tags"></i>assistant</a></li><li><a href=https://foundries.io/tags/att><i class="fa fa-tags"></i>att</a></li><li><a href=https://foundries.io/tags/balena><i class="fa fa-tags"></i>balena</a></li><li><a href=https://foundries.io/tags/ble><i class="fa fa-tags"></i>ble</a></li><li><a href=https://foundries.io/tags/blockchain><i class="fa fa-tags"></i>blockchain</a></li><li><a href=https://foundries.io/tags/bugs><i class="fa fa-tags"></i>bugs</a></li><li><a href=https://foundries.io/tags/container><i class="fa fa-tags"></i>container</a></li><li><a href=https://foundries.io/tags/containers><i class="fa fa-tags"></i>containers</a></li><li><a href=https://foundries.io/tags/crypto><i class="fa fa-tags"></i>crypto</a></li><li><a href=https://foundries.io/tags/cve><i class="fa fa-tags"></i>cve</a></li><li><a href=https://foundries.io/tags/decentralized><i class="fa fa-tags"></i>decentralized</a></li><li><a href=https://foundries.io/tags/demos><i class="fa fa-tags"></i>demos</a></li><li><a href=https://foundries.io/tags/docker><i class="fa fa-tags"></i>docker</a></li><li><a href=https://foundries.io/tags/docker-compose><i class="fa fa-tags"></i>docker-compose</a></li><li><a href=https://foundries.io/tags/edge><i class="fa fa-tags"></i>edge</a></li><li><a href=https://foundries.io/tags/fota><i class="fa fa-tags"></i>fota</a></li><li><a href=https://foundries.io/tags/foundries.io><i class="fa fa-tags"></i>foundries.io</a></li><li><a href=https://foundries.io/tags/foundriesfactory><i class="fa fa-tags"></i>foundriesfactory</a></li><li><a href=https://foundries.io/tags/google><i class="fa fa-tags"></i>google</a></li><li><a href=https://foundries.io/tags/iot><i class="fa fa-tags"></i>iot</a></li><li><a href=https://foundries.io/tags/k8s><i class="fa fa-tags"></i>k8s</a></li><li><a href=https://foundries.io/tags/kernel><i class="fa fa-tags"></i>kernel</a></li><li><a href=https://foundries.io/tags/keys><i class="fa fa-tags"></i>keys</a></li><li><a href=https://foundries.io/tags/kubernetes><i class="fa fa-tags"></i>kubernetes</a></li><li><a href=https://foundries.io/tags/linux><i class="fa fa-tags"></i>linux</a></li><li><a href=https://foundries.io/tags/lmp><i class="fa fa-tags"></i>lmp</a></li><li><a href=https://foundries.io/tags/lte><i class="fa fa-tags"></i>lte</a></li><li><a href=https://foundries.io/tags/lts><i class="fa fa-tags"></i>lts</a></li><li><a href=https://foundries.io/tags/lwm2m><i class="fa fa-tags"></i>lwm2m</a></li><li><a href=https://foundries.io/tags/management><i class="fa fa-tags"></i>management</a></li><li><a href=https://foundries.io/tags/mcuboot><i class="fa fa-tags"></i>mcuboot</a></li><li><a href=https://foundries.io/tags/media><i class="fa fa-tags"></i>media</a></li><li><a href=https://foundries.io/tags/microplatform><i class="fa fa-tags"></i>microplatform</a></li><li><a href=https://foundries.io/tags/open-source><i class="fa fa-tags"></i>open-source</a></li><li><a href=https://foundries.io/tags/ota><i class="fa fa-tags"></i>ota</a></li><li><a href=https://foundries.io/tags/portainer><i class="fa fa-tags"></i>portainer</a></li><li><a href=https://foundries.io/tags/press><i class="fa fa-tags"></i>press</a></li><li><a href=https://foundries.io/tags/radio><i class="fa fa-tags"></i>radio</a></li><li><a href=https://foundries.io/tags/raspberry-pi><i class="fa fa-tags"></i>raspberry-pi</a></li><li><a href=https://foundries.io/tags/raspberry-pi-4><i class="fa fa-tags"></i>raspberry-pi-4</a></li><li><a href=https://foundries.io/tags/security><i class="fa fa-tags"></i>security</a></li><li><a href=https://foundries.io/tags/update><i class="fa fa-tags"></i>update</a></li><li><a href=https://foundries.io/tags/whitepaper><i class="fa fa-tags"></i>whitepaper</a></li><li><a href=https://foundries.io/tags/zephyr><i class="fa fa-tags"></i>zephyr</a></li><li><a href=https://foundries.io/tags/zmp><i class="fa fa-tags"></i>zmp</a></li></ul></div></div></div></div></div></div></div><footer><div class="row footerlinks"><div class="columns small-12 medium-6 border-right"><h2>Company</h2><ul><li><a href=https://foundries.io/company/>About</a></li><li><a href=https://foundries.io/careers/>Careers</a></li><li><a href=https://support.foundries.io/>Support</a></li><li><a href=https://foundries.io/privacy/>Privacy</a></li><li><a href=https://foundries.io/terms/>Terms</a></li></ul></div><div class="columns small-12 medium-6"><h2>Connect</h2><ul class=social-links><li><a href=https://twitter.com/foundriesio><i class="fa fa-twitter fa-2x"></i></a></li><li><a href=https://www.linkedin.com/company/foundriesio/><i class="fa fa-linkedin fa-2x"></i></a></li><li><a href=https://github.com/foundriesio><i class="fa fa-github fa-2x"></i></a></li><li><a href=https://join.slack.com/t/foundriesio/shared_invite/enQtNTc5NDkxNTI5NTExLWQ1Yjc3NDA2MjI3NzA3YzkxYjEzNzlhZjQ0M2QxYTIzYmIzZjlmOThmZGU0NTk5MWEwZGIwMTU2YWE4N2I5NWQ><i class="fa fa-slack fa-2x"></i></a></li></ul></div></div><p class=copyright>Copyright 2018 &ndash; 2019 Foundries.io All rights reserved</p></footer><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-111281311-1','auto');ga('send','pageview');}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><script src=/js/vendor/wow.min.js></script><script src=/js/vendor/what-input.min.js></script><script src=/js/vendor/hoverIntent.js></script><script src=/js/vendor/jquery.responsiveTabs.js></script><script src=/js/vendor/superfish.min.js></script><script src=/js/vendor/owl.carousel.min.js></script><script src=/js/vendor/foundation.min.js></script><script src=/js/vendor/jquery.slicknav.min.js></script><script src=/js/custom.min.js></script><script src=https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js></script><script>window.cookieconsent.initialise({"cookie":{"name":"fio_consent","domain":".foundries.io","secure":false},"palette":{"popup":{"background":"#37485c"},"button":{"background":"#14a7d0"}},"position":"bottom-right","content":{"header":'Cookies used on this website!',"target":"_blank","link":false,"message":"This website uses cookies to enable us to improve your experience, as explained in our Privacy Policy.<br><br>By using this website you agree to our <a class='cc-link' target='_blank' href='https://foundries.io/terms#website'>Terms and Conditions</a> and to our <a class='cc-link' taget='_blank' href='https://foundries.io/privacy/'>Privacy Policy</a>","href":"https://foundries.io/privacy/"}});</script></body></html>